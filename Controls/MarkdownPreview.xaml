<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Jot.Controls.MarkdownPreview"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid>
        <!-- Main Content -->
        <ScrollViewer x:Name="MainScrollViewer" 
                      Background="{ThemeResource LayerFillColorDefaultBrush}" 
                      Padding="16" 
                      VerticalScrollBarVisibility="Auto">
            <StackPanel x:Name="ContentPanel" Spacing="4"/>
        </ScrollViewer>
        
        <!-- Annotation Layer -->
        <Canvas x:Name="AnnotationCanvas" 
                Background="Transparent"
                PointerPressed="AnnotationCanvas_PointerPressed"
                PointerMoved="AnnotationCanvas_PointerMoved"
                PointerReleased="AnnotationCanvas_PointerReleased"
                PointerCaptureLost="AnnotationCanvas_PointerCaptureLost"
                Visibility="Collapsed"
                IsHitTestVisible="False"/>
        
        <!-- Annotation Toolbar (shown when annotation mode is active) -->
        <Border x:Name="AnnotationToolbar" 
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="8"
                Margin="16"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Visibility="Collapsed">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="📝 Annotation Mode" 
                           FontWeight="SemiBold" 
                           VerticalAlignment="Center"
                           Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                
                <Border Width="1" Height="20" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                
                <!-- Annotation Colors -->
                <Button x:Name="RedAnnotationBtn" 
                        Background="Red" 
                        Width="24" Height="24" 
                        CornerRadius="12"
                        Click="AnnotationColor_Click" 
                        Tag="Red"
                        BorderThickness="2"
                        BorderBrush="Transparent"/>
                <Button x:Name="BlueAnnotationBtn" 
                        Background="Blue" 
                        Width="24" Height="24" 
                        CornerRadius="12"
                        Click="AnnotationColor_Click" 
                        Tag="Blue"
                        BorderThickness="2"
                        BorderBrush="Transparent"/>
                <Button x:Name="GreenAnnotationBtn" 
                        Background="Green" 
                        Width="24" Height="24" 
                        CornerRadius="12"
                        Click="AnnotationColor_Click" 
                        Tag="Green"
                        BorderThickness="2"
                        BorderBrush="Transparent"/>
                <Button x:Name="YellowAnnotationBtn" 
                        Background="Yellow" 
                        Width="24" Height="24" 
                        CornerRadius="12"
                        Click="AnnotationColor_Click" 
                        Tag="Yellow"
                        BorderThickness="2"
                        BorderBrush="Gray"/>
                
                <Border Width="1" Height="20" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                
                <!-- Size -->
                <TextBlock Text="Size:" VerticalAlignment="Center" FontSize="12"/>
                <Slider x:Name="AnnotationSizeSlider" 
                        Minimum="1" Maximum="8" Value="2" 
                        Width="60" Height="20"
                        ValueChanged="AnnotationSizeSlider_ValueChanged"/>
                
                <Border Width="1" Height="20" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                
                <!-- Actions -->
                <Button x:Name="UndoAnnotationBtn" 
                        Content="↶" 
                        Click="UndoAnnotation_Click"
                        ToolTipService.ToolTip="Undo last annotation"
                        Width="32" Height="32"/>
                <Button x:Name="ClearAnnotationsBtn" 
                        Content="🗑️" 
                        Click="ClearAnnotations_Click"
                        ToolTipService.ToolTip="Clear all annotations"
                        Width="32" Height="32"/>
                <Button x:Name="ExitAnnotationBtn" 
                        Content="✕" 
                        Click="ExitAnnotationMode_Click"
                        ToolTipService.ToolTip="Exit annotation mode"
                        Width="32" Height="32"/>
            </StackPanel>
        </Border>
        
        <!-- Annotation Mode Toggle Button -->
        <Button x:Name="AnnotationModeButton" 
                Click="AnnotationModeButton_Click" 
                ToolTipService.ToolTip="Annotation Mode - Draw on document"
                Background="Transparent" 
                BorderThickness="0"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="16"
                Width="48" Height="48">
            <FontIcon Glyph="&#xE76D;" Foreground="Orange" FontSize="20"/>
        </Button>
    </Grid>
</UserControl>