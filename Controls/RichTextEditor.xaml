<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Jot.Controls.RichTextEditor"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" Background="{ThemeResource LayerFillColorDefaultBrush}" 
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" 
                BorderThickness="0,0,0,1" Padding="8">
            <ScrollViewer HorizontalScrollMode="Auto" HorizontalScrollBarVisibility="Auto" 
                         VerticalScrollMode="Disabled" VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal" Spacing="4">
                    
                    <!-- Text Formatting -->
                    <Button x:Name="BoldButton" Click="BoldButton_Click" 
                            ToolTipService.ToolTip="Bold (Ctrl+B)"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8DD;" FontWeight="Bold"/>
                    </Button>
                    
                    <Button x:Name="ItalicButton" Click="ItalicButton_Click" 
                            ToolTipService.ToolTip="Italic (Ctrl+I)"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8DB;" FontStyle="Italic"/>
                    </Button>
                    
                    <Button x:Name="StrikethroughButton" Click="StrikethroughButton_Click" 
                            ToolTipService.ToolTip="Strikethrough"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xEDE0;"/>
                    </Button>
                    
                    <Button x:Name="HighlightButton" Click="HighlightButton_Click" 
                            ToolTipService.ToolTip="Highlight"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE7E6;"/>
                    </Button>

                    <!-- Text Color Picker -->
                    <DropDownButton x:Name="TextColorButton" 
                                    ToolTipService.ToolTip="Text Color"
                                    Background="Transparent" BorderThickness="0">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <FontIcon Glyph="&#xE790;" />
                            <Border Width="12" Height="3" Background="{x:Bind CurrentTextColor, Mode=OneWay}" 
                                    VerticalAlignment="Bottom"/>
                        </StackPanel>
                        <DropDownButton.Flyout>
                            <Flyout x:Name="ColorPickerFlyout">
                                <StackPanel Spacing="12" Width="200">
                                    <TextBlock Text="Text Color" FontWeight="SemiBold"/>
                                    
                                    <!-- Quick Colors -->
                                    <TextBlock Text="Quick Colors" FontSize="12" Opacity="0.8"/>
                                    <GridView x:Name="QuickColorsGrid" 
                                              SelectionMode="None"
                                              IsItemClickEnabled="False"
                                              ScrollViewer.HorizontalScrollMode="Disabled"
                                              ScrollViewer.VerticalScrollMode="Disabled"
                                              ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                              ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                              Margin="0,4">
                                        <GridView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VariableSizedWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="8"/>
                                            </ItemsPanelTemplate>
                                        </GridView.ItemsPanel>
                                    </GridView>
                                    
                                    <!-- Advanced Color Picker -->
                                    <TextBlock Text="Custom Color" FontSize="12" Opacity="0.8"/>
                                    <ColorPicker x:Name="CustomColorPicker" 
                                                 IsColorSliderVisible="True"
                                                 IsColorChannelTextInputVisible="True"
                                                 IsHexInputVisible="True"
                                                 ColorChanged="CustomColorPicker_ColorChanged"/>
                                    
                                    <!-- Action Buttons -->
                                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                                        <Button Content="Reset" 
                                                Click="ResetTextColor_Click"
                                                Style="{ThemeResource DefaultButtonStyle}"/>
                                        <Button Content="Apply" 
                                                Click="ApplyTextColor_Click"
                                                Style="{ThemeResource AccentButtonStyle}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Flyout>
                        </DropDownButton.Flyout>
                    </DropDownButton>

                    <MenuFlyoutSeparator/>

                    <!-- Code -->
                    <Button x:Name="CodeButton" Click="CodeButton_Click" 
                            ToolTipService.ToolTip="Inline Code"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE943;"/>
                    </Button>
                    
                    <Button x:Name="CodeBlockButton" Click="CodeBlockButton_Click" 
                            ToolTipService.ToolTip="Code Block"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE90F;"/>
                    </Button>

                    <MenuFlyoutSeparator/>

                    <!-- Headers and Structure -->
                    <Button x:Name="HeaderButton" Click="HeaderButton_Click" 
                            ToolTipService.ToolTip="Header"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8C9;"/>
                    </Button>
                    
                    <Button x:Name="QuoteButton" Click="QuoteButton_Click" 
                            ToolTipService.ToolTip="Quote"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8D3;"/>
                    </Button>

                    <MenuFlyoutSeparator/>

                    <!-- Lists -->
                    <Button x:Name="ListButton" Click="ListButton_Click" 
                            ToolTipService.ToolTip="Bullet List"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8FD;"/>
                    </Button>
                    
                    <Button x:Name="NumberedListButton" Click="NumberedListButton_Click" 
                            ToolTipService.ToolTip="Numbered List"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8FE;"/>
                    </Button>
                    
                    <Button x:Name="CheckboxButton" Click="CheckboxButton_Click" 
                            ToolTipService.ToolTip="Checkbox"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE73A;"/>
                    </Button>

                    <MenuFlyoutSeparator/>

                    <!-- Media and Links -->
                    <Button x:Name="ImageButton" Click="ImageButton_Click" 
                            ToolTipService.ToolTip="Insert Image"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xEB9F;"/>
                    </Button>
                    
                    <Button x:Name="LinkButton" Click="LinkButton_Click" 
                            ToolTipService.ToolTip="Insert Link"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE71B;"/>
                    </Button>

                    <MenuFlyoutSeparator/>

                    <!-- Interactive Elements -->
                    <Button x:Name="CollapsibleButton" Click="CollapsibleButton_Click" 
                            ToolTipService.ToolTip="Collapsible Section"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE76C;"/>
                    </Button>
                    
                    <Button x:Name="QuizButton" Click="QuizButton_Click" 
                            ToolTipService.ToolTip="Insert Quiz"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8EB;"/>
                    </Button>

                    <MenuFlyoutSeparator/>

                    <!-- New Advanced Features -->
                    <Button x:Name="TableButton" Click="TableButton_Click" 
                            ToolTipService.ToolTip="Insert Table"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8EA;"/>
                    </Button>
                    
                    <Button x:Name="EmojiButton" Click="EmojiButton_Click" 
                            ToolTipService.ToolTip="Insert Emoji"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE76E;"/>
                    </Button>
                    
                    <Button x:Name="MathButton" Click="MathButton_Click" 
                            ToolTipService.ToolTip="Insert Math Formula"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8EF;"/>
                    </Button>
                    
                    <Button x:Name="DiagramButton" Click="DiagramButton_Click" 
                            ToolTipService.ToolTip="Insert Diagram"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE8B2;"/>
                    </Button>

                    <MenuFlyoutSeparator/>

                    <!-- Document Tools -->
                    <Button x:Name="StatsButton" Click="StatsButton_Click" 
                            ToolTipService.ToolTip="Document Statistics"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE9D9;"/>
                    </Button>
                    
                    <Button x:Name="FindReplaceButton" Click="FindReplaceButton_Click" 
                            ToolTipService.ToolTip="Find and Replace"
                            Background="Transparent" BorderThickness="0">
                        <FontIcon Glyph="&#xE721;"/>
                    </Button>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Text Editor -->
        <Border Grid.Row="1" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid>
                <!-- Main Text Editor -->
                <TextBox x:Name="ContentTextBox" 
                         AcceptsReturn="True" 
                         TextWrapping="Wrap"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                         BorderThickness="0"
                         Background="Transparent"
                         Padding="16"
                         FontFamily="Consolas, Courier New, monospace"
                         FontSize="14"
                         TextChanged="ContentTextBox_TextChanged"
                         KeyDown="ContentTextBox_KeyDown"/>
                
                <!-- Find and Replace Panel -->
                <Border x:Name="FindReplacePanel" 
                        Background="{ThemeResource LayerFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12"
                        Margin="16"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Visibility="Collapsed">
                    <StackPanel Spacing="8">
                        <TextBox x:Name="FindTextBox" 
                                 PlaceholderText="Find..."
                                 Width="200"/>
                        <TextBox x:Name="ReplaceTextBox" 
                                 PlaceholderText="Replace with..."
                                 Width="200"/>
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <Button x:Name="FindNextButton" 
                                    Content="Find Next"
                                    Click="FindNextButton_Click"
                                    Style="{StaticResource AccentButtonStyle}"/>
                            <Button x:Name="ReplaceButton" 
                                    Content="Replace"
                                    Click="ReplaceButton_Click"/>
                            <Button x:Name="ReplaceAllButton" 
                                    Content="Replace All"
                                    Click="ReplaceAllButton_Click"/>
                            <Button x:Name="CloseFindButton" 
                                    Content="✕"
                                    Click="CloseFindButton_Click"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{ThemeResource LayerFillColorDefaultBrush}" 
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" 
                BorderThickness="0,1,0,0" Padding="16,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16">
                    <TextBlock x:Name="WordCountText" 
                               Text="Words: 0" 
                               FontSize="12" 
                               Opacity="0.7"/>
                    <TextBlock x:Name="CharCountText" 
                               Text="Characters: 0" 
                               FontSize="12" 
                               Opacity="0.7"/>
                    <TextBlock x:Name="ReadingTimeText" 
                               Text="Reading time: 0 min" 
                               FontSize="12" 
                               Opacity="0.7"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <TextBlock x:Name="CursorPositionText" 
                               Text="Line 1, Column 1" 
                               FontSize="12" 
                               Opacity="0.7"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>