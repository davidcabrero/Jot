<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Jot.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Jot"
    xmlns:controls="using:Jot.Controls"
    xmlns:models="using:Jot.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:Jot.Converters"
    mc:Ignorable="d"
    Title="Jot - Modern Note Taking">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid x:Name="RootGrid">
        <Grid.Resources>
            <converters:LocalizationConverter x:Key="LocalizationConverter"/>
        </Grid.Resources>
<Grid.RowDefinitions>
       <RowDefinition Height="Auto"/>
       <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Grid Grid.Row="0" Background="{ThemeResource LayerFillColorDefaultBrush}" 
  Height="48" Padding="16,0">
<Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
         </Grid.ColumnDefinitions>

            <Button Grid.Column="0" x:Name="TogglePaneButton" 
  Background="Transparent" BorderThickness="0"
       ToolTipService.ToolTip="Toggle Sidebar">
             <FontIcon Glyph="&#xE700;" FontSize="16"/>
            </Button>

            <TextBlock Grid.Column="1" Text="Jot" 
       FontWeight="SemiBold" FontSize="16"
 VerticalAlignment="Center" HorizontalAlignment="Center"/>

 <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
         <Button Background="Transparent" BorderThickness="0"
   Click="CreateNewDocument_Click"
                  ToolTipService.ToolTip="New Document">
      <FontIcon Glyph="&#xE710;" FontSize="16"/>
    </Button>
         <Button Background="Transparent" BorderThickness="0"
    Click="SaveDocument_Click"
             ToolTipService.ToolTip="Save">
            <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                </Button>
                <Button Background="Transparent" BorderThickness="0"
    Click="ExportToHtml_Click"
                ToolTipService.ToolTip="Export to HTML">
         <FontIcon Glyph="&#xE12B;" FontSize="16"/>
    </Button>
    <Border Width="1" Height="20" Background="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="4,0"/>
      <Button Background="Transparent" BorderThickness="0"
        Click="OpenPythonDialog_Click"
      ToolTipService.ToolTip="Python Code Execution">
    <FontIcon Glyph="&#xE943;" FontSize="16"/>
  </Button>
          <!-- GitHub Upload Button (more prominent) -->
    <Button x:Name="QuickGitHubUploadButton"
       Background="Transparent" 
            BorderThickness="0"
      Click="QuickUploadToGitHub_Click"
     ToolTipService.ToolTip="Quick Upload to GitHub">
    <StackPanel Orientation="Horizontal" Spacing="4">
 <FontIcon Glyph="&#xE89B;" FontSize="16"/>
     <FontIcon Glyph="&#xE898;" FontSize="12" Margin="0,-8,0,0"/>
  </StackPanel>
 </Button>
          <Button Background="Transparent" BorderThickness="0"
 Click="SetupGitHub_Click"
     ToolTipService.ToolTip="GitHub Settings">
          <FontIcon Glyph="&#xE8F7;" FontSize="16"/>
  </Button>

           <!-- Language Selection Button -->
           <Button x:Name="LanguageButton" Background="Transparent" BorderThickness="0"
                   ToolTipService.ToolTip="Language / Idioma">
               <Button.Flyout>
                   <MenuFlyout x:Name="LanguageFlyout">
                       <MenuFlyoutItem Text="English" x:Name="EnglishMenuItem" Click="ChangeLanguage_Click" Tag="en">
                           <MenuFlyoutItem.Icon>
                               <FontIcon Glyph="&#xE71B;" FontSize="16"/>
                           </MenuFlyoutItem.Icon>
                       </MenuFlyoutItem>
                       <MenuFlyoutItem Text="Español" x:Name="SpanishMenuItem" Click="ChangeLanguage_Click" Tag="es">
                           <MenuFlyoutItem.Icon>
                               <FontIcon Glyph="&#xE71B;" FontSize="16"/>
                           </MenuFlyoutItem.Icon>
                       </MenuFlyoutItem>
                       <MenuFlyoutItem Text="Català" x:Name="CatalanMenuItem" Click="ChangeLanguage_Click" Tag="ca">
                           <MenuFlyoutItem.Icon>
                               <FontIcon Glyph="&#xE71B;" FontSize="16"/>
                           </MenuFlyoutItem.Icon>
                       </MenuFlyoutItem>
                       <MenuFlyoutItem Text="Asturianu" x:Name="AsturianMenuItem" Click="ChangeLanguage_Click" Tag="ast">
                           <MenuFlyoutItem.Icon>
                               <FontIcon Glyph="&#xE71B;" FontSize="16"/>
                           </MenuFlyoutItem.Icon>
                       </MenuFlyoutItem>
                   </MenuFlyout>
               </Button.Flyout>
               <StackPanel Orientation="Horizontal" Spacing="4">
                   <FontIcon Glyph="&#xE774;" FontSize="16"/>
                   <TextBlock x:Name="CurrentLanguageText" Text="EN" FontSize="10" VerticalAlignment="Center"/>
               </StackPanel>
           </Button>

           <Border Width="1" Height="20" Background="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="4,0"/>
     <Button Background="Transparent" BorderThickness="0"
   Click="ToggleChatbot_Click"
        ToolTipService.ToolTip="AI Assistant">
            <FontIcon Glyph="&#xE8F2;" FontSize="16"/>
     </Button>

           <Border Width="1" Height="20" Background="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="4,0"/>
           <Button Background="Transparent" BorderThickness="0"
                   Click="SendEmail_Click"
                   ToolTipService.ToolTip="Send by Email">
               <FontIcon Glyph="&#xE715;" FontSize="16"/>
           </Button>
 </StackPanel>
      </Grid>

        <!-- Main Content -->
     <NavigationView Grid.Row="1" x:Name="MainNavigationView"
   IsBackButtonVisible="Collapsed"
            OpenPaneLength="300"
        CompactModeThresholdWidth="0"
       ExpandedModeThresholdWidth="600">

    <NavigationView.PaneHeader>
            <Grid Margin="12,8">
       <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
       <RowDefinition Height="Auto"/>
    <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

<TextBlock Grid.Row="0" x:Name="DocumentsHeaderText" Text="Documents" 
         FontWeight="SemiBold" FontSize="16" Margin="0,0,0,8"/>
    
        <TextBox Grid.Row="1" x:Name="SearchBox" 
     PlaceholderText="Search documents...">
       <TextBox.Resources>
 <ResourceDictionary>
      <SolidColorBrush x:Key="TextControlBackgroundFocused" Color="Transparent"/>
      </ResourceDictionary>
  </TextBox.Resources>
       </TextBox>

             <!-- GitHub Status Panel -->
                <Border Grid.Row="2" 
        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
          BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
   BorderThickness="1"
   CornerRadius="4"
        Margin="0,8,0,0"
      Padding="8">
         <StackPanel Spacing="8">
                <Grid>
        <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
 <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
                 </Grid.ColumnDefinitions>
     
      <FontIcon Grid.Column="0" 
         Glyph="&#xE89B;" 
          FontSize="16" 
              Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
   VerticalAlignment="Center"/>
              
   <TextBlock Grid.Column="1" 
    Text="GitHub" 
      FontWeight="SemiBold" 
             VerticalAlignment="Center"
    Margin="8,0,0,0"
    x:Name="GitHubHeaderText"/>
                  
         <Button Grid.Column="2" 
   x:Name="GitHubToggleButton"
      Background="Transparent" 
            BorderThickness="0"
         Click="ToggleGitHubPanel_Click"
      ToolTipService.ToolTip="Expand GitHub Options">
           <FontIcon Glyph="&#xE70D;" FontSize="12"/>
      </Button>
     </Grid>
       
                <StackPanel x:Name="GitHubStatusPanel" Spacing="6">
           <!-- Connection Status -->
      <Grid x:Name="GitHubConnectionStatus">
      <Grid.ColumnDefinitions>
     <ColumnDefinition Width="Auto"/>
    <ColumnDefinition Width="*"/>
     </Grid.ColumnDefinitions>
            
       <Ellipse Grid.Column="0" 
           x:Name="GitHubStatusIndicator"
       Width="8" Height="8"
           Fill="Red"
         VerticalAlignment="Center"/>
     
      <TextBlock Grid.Column="1" 
x:Name="GitHubStatusText"
         Text="Not Connected" 
               FontSize="12"
     Opacity="0.8"
Margin="6,0,0,0"
 VerticalAlignment="Center"/>
          </Grid>
     
     <!-- GitHub Actions when connected -->
        <StackPanel x:Name="GitHubActionsPanel" 
          Visibility="Collapsed" 
         Spacing="4">
             
                <Button x:Name="UploadCurrentDocButton"
    Background="{ThemeResource AccentFillColorDefaultBrush}"
          Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
       HorizontalAlignment="Stretch"
          Click="UploadCurrentDocument_Click"
        Padding="8,4">
      <StackPanel Orientation="Horizontal" Spacing="6">
   <FontIcon Glyph="&#xE898;" FontSize="14"/>
      <TextBlock x:Name="UploadCurrentText" Text="Upload Current" FontSize="12"/>
     </StackPanel>
        </Button>
     
               <Button x:Name="ManageReposButton"
                Background="Transparent"
   BorderBrush="{ThemeResource AccentFillColorDefaultBrush}"
          BorderThickness="1"
    HorizontalAlignment="Stretch"
               Click="ManageRepositories_Click"
         Padding="8,4">
    <StackPanel Orientation="Horizontal" Spacing="6">
           <FontIcon Glyph="&#xE8F7;" FontSize="14"/>
    <TextBlock x:Name="RepositoriesText" Text="Repositories" FontSize="12"/>
             </StackPanel>
           </Button>
            
          <Button x:Name="DisconnectGitHubButton"
           Background="Transparent"
          BorderThickness="0"
              HorizontalAlignment="Stretch"
      Click="DisconnectGitHub_Click"
                Padding="8,4">
                <StackPanel Orientation="Horizontal" Spacing="6">
  <FontIcon Glyph="&#xE8BB;" FontSize="14"/>
 <TextBlock x:Name="DisconnectText" Text="Disconnect" FontSize="12" Opacity="0.8"/>
      </StackPanel>
           </Button>
           </StackPanel>
       
   <!-- Setup button when not connected -->
     <Button x:Name="SetupGitHubButton"
   Background="{ThemeResource AccentFillColorDefaultBrush}"
        Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                HorizontalAlignment="Stretch"
          Click="SetupGitHub_Click"
      Padding="8,4">
    <StackPanel Orientation="Horizontal" Spacing="6">
             <FontIcon Glyph="&#xE8FA;" FontSize="14"/>
      <TextBlock x:Name="ConnectGitHubText" Text="Connect GitHub" FontSize="12"/>
        </StackPanel>
      </Button>
 </StackPanel>
      </StackPanel>
     </Border>
       </Grid>
     </NavigationView.PaneHeader>

            <NavigationView.PaneCustomContent>
      <ListView x:Name="DocumentsList" 
    SelectionMode="Single"
            Margin="8,0,8,8">
   <ListView.ItemTemplate>
      <DataTemplate x:DataType="models:Document">
    <Grid Margin="4" Background="Transparent">
             <Grid.RowDefinitions>
  <RowDefinition Height="Auto"/>
               <RowDefinition Height="Auto"/>
     <RowDefinition Height="Auto"/>
         </Grid.RowDefinitions>
       <Grid.ContextFlyout>
             <MenuFlyout>
         <MenuFlyoutItem Text="Export to HTML"
   Click="ExportDocumentToHtml_Click"
         CommandParameter="{x:Bind}">
         <MenuFlyoutItem.Icon>
   <FontIcon Glyph="&#xE12B;"/>
     </MenuFlyoutItem.Icon>
               </MenuFlyoutItem>
           <MenuFlyoutItem Text="Upload to GitHub"
   Click="UploadDocumentToGitHub_Click"
    CommandParameter="{x:Bind}">
         <MenuFlyoutItem.Icon>
       <FontIcon Glyph="&#xE89B;"/>
      </MenuFlyoutItem.Icon>
     </MenuFlyoutItem>
     <MenuFlyoutSeparator/>
       <MenuFlyoutItem Text="Delete"
  Click="DeleteDocument_Click"
     CommandParameter="{x:Bind}">
           <MenuFlyoutItem.Icon>
<FontIcon Glyph="&#xE74D;"/>
   </MenuFlyoutItem.Icon>
 </MenuFlyoutItem>
          </MenuFlyout>
             </Grid.ContextFlyout>

          <TextBlock Grid.Row="0" Text="{x:Bind Title}" 
        FontWeight="SemiBold" 
               TextTrimming="CharacterEllipsis"
  MaxLines="1"/>
        
           <TextBlock Grid.Row="1" 
        Text="{x:Bind Content}" 
   Opacity="0.7" 
             FontSize="12"
 TextTrimming="CharacterEllipsis"
           MaxLines="2" 
       Margin="0,2,0,0"/>
          
   <TextBlock Grid.Row="2" 
        Text="{x:Bind ModifiedAt}" 
  Opacity="0.5" 
        FontSize="10"
  Margin="0,4,0,0"/>
                 </Grid>
       </DataTemplate>
  </ListView.ItemTemplate>
       </ListView>
            </NavigationView.PaneCustomContent>

    <Grid>
        <Grid.ColumnDefinitions>
   <ColumnDefinition Width="*"/>
      <ColumnDefinition Width="Auto"/>
                 <ColumnDefinition Width="200"/>
    </Grid.ColumnDefinitions>

            <!-- Main Document Area -->
  <Grid Grid.Column="0">
    <Grid.RowDefinitions>
   <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
           </Grid.RowDefinitions>

  <!-- Document Header -->
   <Border Grid.Row="0" x:Name="DocumentHeaderBorder"
  Background="{ThemeResource LayerFillColorDefaultBrush}" 
 BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" 
           BorderThickness="0,0,0,1" 
       Padding="16,12">
            <Grid>
           <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
           </Grid.ColumnDefinitions>

          <TextBox Grid.Column="0" x:Name="TitleTextBox"
             FontSize="18" 
       FontWeight="SemiBold"
       BorderThickness="0" 
    Background="Transparent"
          PlaceholderText="Document title..."
      TextChanged="TitleTextBox_TextChanged"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
            <!-- View Mode Toggle -->
  <ToggleButton x:Name="EditModeButton" 
  Content="Edit" 
             ToolTipService.ToolTip="Edit Mode"/>

         <ToggleButton x:Name="PreviewModeButton" 
  Content="Preview" 
         ToolTipService.ToolTip="Preview Mode"/>

       <ToggleButton x:Name="SplitModeButton" 
      Content="Split" 
       ToolTipService.ToolTip="Split Mode"/>

        <TextBlock x:Name="LastModifiedText" Text="Last modified"
Opacity="0.7" 
     FontSize="12" 
    VerticalAlignment="Center"
         Margin="16,0,0,0"/>
              </StackPanel>
 </Grid>
  </Border>

          <!-- Editor Container -->
           <Grid Grid.Row="1" x:Name="EditorContainer">
               
<!-- Edit Mode -->
             <controls:RichTextEditor x:Name="TextEditor"/>
        
    <!-- Preview Mode -->
          <controls:MarkdownPreview x:Name="MarkdownPreview" 
  Visibility="Collapsed"/>
        
         <!-- Split Mode -->
          <Grid x:Name="SplitModeGrid" Visibility="Collapsed">
    <Grid.ColumnDefinitions>
         <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="2"/>
         <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>
       

           <controls:RichTextEditor x:Name="SplitModeEditor" Grid.Column="0"/>
     
       <Border Grid.Column="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>
          
      <controls:MarkdownPreview x:Name="SplitModePreview" Grid.Column="2"/>
           </Grid>
            </Grid>

        <!-- Empty State -->
    <Grid Grid.Row="1" x:Name="EmptyStateGrid">
   <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
 <FontIcon Glyph="&#xE8A5;" FontSize="64" Opacity="0.3"/>
         <TextBlock x:Name="WelcomeText" Text="Welcome to Jot" FontSize="24" FontWeight="SemiBold" HorizontalAlignment="Center"/>
      <TextBlock x:Name="CreateFirstDocText" Text="Create your first document to get started" Opacity="0.7" HorizontalAlignment="Center"/>
   <Button x:Name="CreateNewDocButton" Content="Create New Document" 
      Style="{ThemeResource AccentButtonStyle}"
            Click="CreateNewDocument_Click"/>
                  </StackPanel>
         </Grid>
    </Grid>

          <!-- Splitter -->
        <Border Grid.Column="1" Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" 
        Margin="8,0"/>

    <!-- Document Index -->
   <Grid Grid.Column="2" Background="{ThemeResource LayerFillColorDefaultBrush}">
       <Grid.RowDefinitions>
   <RowDefinition Height="Auto"/>
   <RowDefinition Height="*"/>
       </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
    BorderThickness="0,0,0,1"
      Padding="12,8">
         <TextBlock x:Name="DocumentIndexHeader" Text="Document Index" 
          FontWeight="SemiBold" 
        FontSize="14"/>
     </Border>

        <ListView Grid.Row="1" x:Name="DocumentIndexList"
           SelectionMode="Single"
          SelectionChanged="DocumentIndex_SelectionChanged"
            Padding="8">
 <ListView.ItemTemplate>
  <DataTemplate x:DataType="local:DocumentHeading">
            <Grid>
    <TextBlock Text="{x:Bind IndentedTitle}" 
      FontSize="12"
TextTrimming="CharacterEllipsis"
                 Margin="0,2"/>
        </Grid>
          </DataTemplate>
          </ListView.ItemTemplate>
  <ListView.ItemContainerStyle>
 <Style TargetType="ListViewItem">
           <Setter Property="Padding" Value="4,2"/>
   <Setter Property="MinHeight" Value="0"/>
       </Style>
         </ListView.ItemContainerStyle>
                </ListView>
         </Grid>
            </Grid>
        </NavigationView>

        <!-- Loading overlay for HTML export -->
        <Grid x:Name="LoadingOverlay" 
              Background="{ThemeResource SystemControlBackgroundAccentBrush}" 
        Opacity="0.8"
    Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
     <ProgressRing IsActive="True" Width="48" Height="48"/>
                <TextBlock x:Name="ExportingText" Text="Exporting to HTML..." FontSize="16" HorizontalAlignment="Center"/>
      </StackPanel>
    </Grid>
</Grid>
</Window>
